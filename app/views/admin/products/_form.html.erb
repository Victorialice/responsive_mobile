<style type="text/css">
	#editor {overflow:scroll; max-height:300px}
</style>
<%= form_for [:admin, @product], html: {class: "form-horizontal", multipart: true} do |f| %>
<div class="box-body">
  <%= render 'admin/shared/error', model: @product %>
  <fieldset>
    <div class="form-inputs">
      <div class="form-group string requirede">
        <label class="string required col-sm-2 control-label">
          <abbr title="required">*</abbr> 编号
        </label>
        <div class="col-sm-4">
          <%= f.text_field :sku, class: "string required form-control" %>
        </div>
      </div>
    </div>
		
    <div class="form-inputs">
      <div class="form-group string requirede">
        <label class="string required col-sm-2 control-label">
          <abbr title="required">*</abbr>标题
        </label>
        <div class="col-sm-4">
          <%= f.text_field :title, class: "string required form-control" %>
        </div>
      </div>
    </div>

		<div class="form-inputs">
      <div class="form-group string requirede">
        <label class="col-sm-2 control-label"> 描述 </label>
        <div class="col-sm-4">
          <%= f.text_field :desc_as_option, class: "string required form-control" %>
        </div>
      </div>
    </div>

		<div class="form-inputs">
      <div class="form-group string">
        <label class="string col-sm-2 control-label"> 本体或选件 </label>
        <div class="col-sm-2">
          <label class="checkbox-inline">
            <%= f.check_box :is_main_body %> 是否为本体
          </label>
        </div>
        <div class="col-sm-2">
          <label class="checkbox-inline">
            <%= f.check_box :is_main_body %> 是否为选件
          </label>
        </div>
      </div>
		</div>

		<div class="form-inputs">
      <div class="form-group string requirede">
        <label class="col-sm-2 control-label"> 作为选件图片 </label>
				<%= image_tag(@product.option_avatar.thumb.url) if @product.option_avatar? %>
        <div class="col-sm-4">
          <%= f.file_field :avatar, class: "string required form-control" %>
        </div>
      </div>
    </div>

		<div class="form-inputs">
      <div class="form-group string requirede">
        <label class="col-sm-2 control-label"> 作为主体banner </label>
				<%= image_tag(@product.banner.thumb.url) if @product.banner? %>
        <div class="col-sm-4">
          <%= f.file_field :avatar, class: "string required form-control" %>
        </div>
      </div>
    </div>

		<div class="form-inputs">
      <div class="form-group text requirede">
        <label class="col-sm-2 control-label"> 概要 </label>
        <div class="col-sm-4">
          <%= f.text_field :summary %>
        </div>
      </div>
    </div>
		
		<div id="editor" class="lead" data-placeholder="Go ahead&hellip;"></div>


	</fieldset>
	
	<div class="form-group">
		<div class="col-sm-4 col-sm-offset-2">
			<%= f.button '保存', class: 'btn btn-primary' %>
			<%= link_to '取消', [:admin, :products], class: 'btn btn-warning' %>
		</div>
	</div>
</div>
<% end %>

<script src="/plugin/bootstrap-wysiwyg/bower_components/jquery.hotkeys/jquery.hotkeys.js"></script>
<script src="/plugin/bootstrap-wysiwyg/bower_components/google-code-prettify/src/prettify.js"></script>
<script src="/plugin/bootstrap-wysiwyg/src/bootstrap-wysiwyg.js"></script>

		<script>
			$(function()
			{
		    	function initToolbarBootstrapBindings()
		    	{
		      		var fonts = ['Serif', 'Sans', 'Arial', 'Arial Black', 'Courier', 
		            	'Courier New', 'Comic Sans MS', 'Helvetica', 'Impact', 'Lucida Grande', 'Lucida Sans', 'Tahoma', 'Times',
		            	'Times New Roman', 'Verdana'],
		            	fontTarget = $('[title=Font]').siblings('.dropdown-menu');
		      
		      		$.each(fonts, function (idx, fontName)
		      		{
		          		fontTarget.append($('<li><a data-edit="fontName ' + fontName +'" style="font-family:\''+ fontName +'\'">'+fontName + '</a></li>'));
		      		});

		      		$('a[title]').tooltip({container:'body'});

		    		$('.dropdown-menu input').click(function() {return false;})
				    	.change(function ()
				    	{
				    		$(this).parent('.dropdown-menu').siblings('.dropdown-toggle').dropdown('toggle');
				    	}).keydown('esc', function ()
		        			{
		        				this.value='';$(this).change();
		        			});

		    		$('[data-role=magic-overlay]').each(function ()
		      		{ 
		       			var overlay = $(this), target = $(overlay.data('target')); 
		        		overlay.css('opacity', 0).css('position', 'absolute').offset(target.offset()).width(target.outerWidth()).height(target.outerHeight());
		      		});
		      
		      		if ("onwebkitspeechchange"  in document.createElement("input")) 
		      		{
		        		var editorOffset = $('#editor').offset();
		        		//$('#voiceBtn').css('position','absolute').offset({top: editorOffset.top, left: editorOffset.left+$('#editor').innerWidth()-35});
		      		}

		      		else
		      		{
		        		$('#voiceBtn').hide();
					}
				};

			function showErrorAlert (reason, detail)
			{
				var msg='';
				if (reason==='unsupported-file-type')
				{
					msg = "Unsupported format " + detail;
				}
				else
				{
					console.log("error uploading file", reason, detail);
				}

				$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button>'+ 
					'<strong>File upload error</strong> '+msg+' </div>').prependTo('#alerts');
			};

		    initToolbarBootstrapBindings();  

			$('#editor').wysiwyg({ fileUploadError: showErrorAlert} );

		    window.prettyPrint && prettyPrint();
		  });
		</script>

